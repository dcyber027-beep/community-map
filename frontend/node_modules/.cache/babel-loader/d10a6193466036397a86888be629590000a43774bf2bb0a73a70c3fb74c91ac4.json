{"ast":null,"code":"var _jsxFileName = \"/app/frontend/src/components/MapView.jsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState } from 'react';\nimport L from 'leaflet';\nimport 'leaflet/dist/leaflet.css';\nimport { MapPin } from 'lucide-react';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst MapView = ({\n  incidents,\n  userLocation,\n  getCategoryEmoji,\n  onMapClick\n}) => {\n  _s();\n  const mapRef = useRef(null);\n  const mapInstanceRef = useRef(null);\n  const markersRef = useRef([]);\n  const draggableMarkerRef = useRef(null);\n  const [showPinHelper, setShowPinHelper] = useState(true);\n  useEffect(() => {\n    // Initialize map only once\n    if (!mapInstanceRef.current && mapRef.current) {\n      // Default to Melbourne CBD\n      const defaultCenter = [-37.8136, 144.9631];\n      mapInstanceRef.current = L.map(mapRef.current).setView(defaultCenter, 13);\n      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n        attribution: '© OpenStreetMap contributors',\n        maxZoom: 19\n      }).addTo(mapInstanceRef.current);\n    }\n\n    // Clear existing markers\n    markersRef.current.forEach(marker => marker.remove());\n    markersRef.current = [];\n\n    // Add user location marker\n    if (userLocation && mapInstanceRef.current) {\n      const userMarker = L.marker([userLocation.latitude, userLocation.longitude], {\n        icon: L.divIcon({\n          className: 'custom-user-marker',\n          html: `<div style=\"background-color: #3b82f6; width: 16px; height: 16px; border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 8px rgba(0,0,0,0.3);\"></div>`,\n          iconSize: [16, 16],\n          iconAnchor: [8, 8]\n        })\n      });\n      userMarker.bindPopup('<b>Your Location</b>');\n      userMarker.addTo(mapInstanceRef.current);\n      markersRef.current.push(userMarker);\n\n      // Add 500m radius circle\n      const circle = L.circle([userLocation.latitude, userLocation.longitude], {\n        color: '#3b82f6',\n        fillColor: '#3b82f6',\n        fillOpacity: 0.1,\n        radius: 500\n      }).addTo(mapInstanceRef.current);\n      markersRef.current.push(circle);\n    }\n\n    // Add incident markers\n    incidents.forEach(incident => {\n      const urgencyColors = {\n        low: '#10b981',\n        medium: '#f59e0b',\n        high: '#ef4444'\n      };\n      const emoji = getCategoryEmoji(incident.category);\n      const color = urgencyColors[incident.urgency] || '#6b7280';\n      const marker = L.marker([incident.latitude, incident.longitude], {\n        icon: L.divIcon({\n          className: 'custom-incident-marker',\n          html: `\n            <div style=\"\n              background-color: ${color};\n              width: 40px;\n              height: 40px;\n              border-radius: 50%;\n              display: flex;\n              align-items: center;\n              justify-content: center;\n              border: 3px solid white;\n              box-shadow: 0 4px 12px rgba(0,0,0,0.3);\n              font-size: 20px;\n              cursor: pointer;\n              transition: transform 0.2s;\n            \">${emoji}</div>\n          `,\n          iconSize: [40, 40],\n          iconAnchor: [20, 20]\n        })\n      });\n      const timeAgo = getTimeAgo(new Date(incident.timestamp));\n      const verifiedBadge = incident.is_verified ? '<span style=\"color: #10b981; font-weight: bold;\">✓ Verified</span>' : '<span style=\"color: #f59e0b;\">⚠ Unverified</span>';\n      const clusterInfo = incident.cluster_count > 1 ? `<br><span style=\"color: #ef4444; font-weight: bold;\">${incident.cluster_count} reports in this area</span>` : '';\n      marker.bindPopup(`\n        <div style=\"min-width: 200px;\">\n          <div style=\"font-size: 18px; margin-bottom: 8px;\">${emoji} <b>${incident.category.toUpperCase()}</b></div>\n          <div style=\"margin-bottom: 4px;\"><b>Urgency:</b> <span style=\"color: ${color}; font-weight: bold;\">${incident.urgency.toUpperCase()}</span></div>\n          <div style=\"margin-bottom: 4px;\"><b>Status:</b> ${verifiedBadge}</div>\n          <div style=\"margin-bottom: 8px;\"><b>Time:</b> ${timeAgo}</div>\n          <div style=\"border-top: 1px solid #e5e7eb; padding-top: 8px; margin-top: 8px;\">${incident.description}</div>\n          ${clusterInfo}\n        </div>\n      `);\n      marker.addTo(mapInstanceRef.current);\n      markersRef.current.push(marker);\n    });\n\n    // Auto-center map if there are incidents\n    if (incidents.length > 0 && mapInstanceRef.current) {\n      const bounds = L.latLngBounds(incidents.map(i => [i.latitude, i.longitude]));\n      if (userLocation) {\n        bounds.extend([userLocation.latitude, userLocation.longitude]);\n      }\n      mapInstanceRef.current.fitBounds(bounds, {\n        padding: [50, 50]\n      });\n    } else if (userLocation && mapInstanceRef.current) {\n      mapInstanceRef.current.setView([userLocation.latitude, userLocation.longitude], 14);\n    }\n    return () => {\n      // Cleanup on unmount only\n      if (mapInstanceRef.current) {\n        markersRef.current.forEach(marker => marker.remove());\n      }\n    };\n  }, [incidents, userLocation]);\n  const getTimeAgo = date => {\n    const seconds = Math.floor((new Date() - date) / 1000);\n    if (seconds < 60) return 'Just now';\n    if (seconds < 3600) return `${Math.floor(seconds / 60)} min ago`;\n    if (seconds < 86400) return `${Math.floor(seconds / 3600)} hr ago`;\n    return `${Math.floor(seconds / 86400)} days ago`;\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    \"data-testid\": \"map-view\",\n    ref: mapRef,\n    style: {\n      height: '600px',\n      width: '100%'\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 138,\n    columnNumber: 5\n  }, this);\n};\n_s(MapView, \"N2AsfZE/V/3eWXNj5NQzZ49EmOM=\");\n_c = MapView;\nexport default MapView;\nvar _c;\n$RefreshReg$(_c, \"MapView\");","map":{"version":3,"names":["React","useEffect","useRef","useState","L","MapPin","jsxDEV","_jsxDEV","MapView","incidents","userLocation","getCategoryEmoji","onMapClick","_s","mapRef","mapInstanceRef","markersRef","draggableMarkerRef","showPinHelper","setShowPinHelper","current","defaultCenter","map","setView","tileLayer","attribution","maxZoom","addTo","forEach","marker","remove","userMarker","latitude","longitude","icon","divIcon","className","html","iconSize","iconAnchor","bindPopup","push","circle","color","fillColor","fillOpacity","radius","incident","urgencyColors","low","medium","high","emoji","category","urgency","timeAgo","getTimeAgo","Date","timestamp","verifiedBadge","is_verified","clusterInfo","cluster_count","toUpperCase","description","length","bounds","latLngBounds","i","extend","fitBounds","padding","date","seconds","Math","floor","ref","style","height","width","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["/app/frontend/src/components/MapView.jsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport L from 'leaflet';\nimport 'leaflet/dist/leaflet.css';\nimport { MapPin } from 'lucide-react';\n\nconst MapView = ({ incidents, userLocation, getCategoryEmoji, onMapClick }) => {\n  const mapRef = useRef(null);\n  const mapInstanceRef = useRef(null);\n  const markersRef = useRef([]);\n  const draggableMarkerRef = useRef(null);\n  const [showPinHelper, setShowPinHelper] = useState(true);\n\n  useEffect(() => {\n    // Initialize map only once\n    if (!mapInstanceRef.current && mapRef.current) {\n      // Default to Melbourne CBD\n      const defaultCenter = [-37.8136, 144.9631];\n      \n      mapInstanceRef.current = L.map(mapRef.current).setView(defaultCenter, 13);\n\n      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n        attribution: '© OpenStreetMap contributors',\n        maxZoom: 19\n      }).addTo(mapInstanceRef.current);\n    }\n\n    // Clear existing markers\n    markersRef.current.forEach(marker => marker.remove());\n    markersRef.current = [];\n\n    // Add user location marker\n    if (userLocation && mapInstanceRef.current) {\n      const userMarker = L.marker([userLocation.latitude, userLocation.longitude], {\n        icon: L.divIcon({\n          className: 'custom-user-marker',\n          html: `<div style=\"background-color: #3b82f6; width: 16px; height: 16px; border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 8px rgba(0,0,0,0.3);\"></div>`,\n          iconSize: [16, 16],\n          iconAnchor: [8, 8]\n        })\n      });\n      userMarker.bindPopup('<b>Your Location</b>');\n      userMarker.addTo(mapInstanceRef.current);\n      markersRef.current.push(userMarker);\n\n      // Add 500m radius circle\n      const circle = L.circle([userLocation.latitude, userLocation.longitude], {\n        color: '#3b82f6',\n        fillColor: '#3b82f6',\n        fillOpacity: 0.1,\n        radius: 500\n      }).addTo(mapInstanceRef.current);\n      markersRef.current.push(circle);\n    }\n\n    // Add incident markers\n    incidents.forEach(incident => {\n      const urgencyColors = {\n        low: '#10b981',\n        medium: '#f59e0b',\n        high: '#ef4444'\n      };\n\n      const emoji = getCategoryEmoji(incident.category);\n      const color = urgencyColors[incident.urgency] || '#6b7280';\n\n      const marker = L.marker([incident.latitude, incident.longitude], {\n        icon: L.divIcon({\n          className: 'custom-incident-marker',\n          html: `\n            <div style=\"\n              background-color: ${color};\n              width: 40px;\n              height: 40px;\n              border-radius: 50%;\n              display: flex;\n              align-items: center;\n              justify-content: center;\n              border: 3px solid white;\n              box-shadow: 0 4px 12px rgba(0,0,0,0.3);\n              font-size: 20px;\n              cursor: pointer;\n              transition: transform 0.2s;\n            \">${emoji}</div>\n          `,\n          iconSize: [40, 40],\n          iconAnchor: [20, 20]\n        })\n      });\n\n      const timeAgo = getTimeAgo(new Date(incident.timestamp));\n      const verifiedBadge = incident.is_verified ? '<span style=\"color: #10b981; font-weight: bold;\">✓ Verified</span>' : '<span style=\"color: #f59e0b;\">⚠ Unverified</span>';\n      const clusterInfo = incident.cluster_count > 1 ? `<br><span style=\"color: #ef4444; font-weight: bold;\">${incident.cluster_count} reports in this area</span>` : '';\n\n      marker.bindPopup(`\n        <div style=\"min-width: 200px;\">\n          <div style=\"font-size: 18px; margin-bottom: 8px;\">${emoji} <b>${incident.category.toUpperCase()}</b></div>\n          <div style=\"margin-bottom: 4px;\"><b>Urgency:</b> <span style=\"color: ${color}; font-weight: bold;\">${incident.urgency.toUpperCase()}</span></div>\n          <div style=\"margin-bottom: 4px;\"><b>Status:</b> ${verifiedBadge}</div>\n          <div style=\"margin-bottom: 8px;\"><b>Time:</b> ${timeAgo}</div>\n          <div style=\"border-top: 1px solid #e5e7eb; padding-top: 8px; margin-top: 8px;\">${incident.description}</div>\n          ${clusterInfo}\n        </div>\n      `);\n\n      marker.addTo(mapInstanceRef.current);\n      markersRef.current.push(marker);\n    });\n\n    // Auto-center map if there are incidents\n    if (incidents.length > 0 && mapInstanceRef.current) {\n      const bounds = L.latLngBounds(incidents.map(i => [i.latitude, i.longitude]));\n      if (userLocation) {\n        bounds.extend([userLocation.latitude, userLocation.longitude]);\n      }\n      mapInstanceRef.current.fitBounds(bounds, { padding: [50, 50] });\n    } else if (userLocation && mapInstanceRef.current) {\n      mapInstanceRef.current.setView([userLocation.latitude, userLocation.longitude], 14);\n    }\n\n    return () => {\n      // Cleanup on unmount only\n      if (mapInstanceRef.current) {\n        markersRef.current.forEach(marker => marker.remove());\n      }\n    };\n  }, [incidents, userLocation]);\n\n  const getTimeAgo = (date) => {\n    const seconds = Math.floor((new Date() - date) / 1000);\n    \n    if (seconds < 60) return 'Just now';\n    if (seconds < 3600) return `${Math.floor(seconds / 60)} min ago`;\n    if (seconds < 86400) return `${Math.floor(seconds / 3600)} hr ago`;\n    return `${Math.floor(seconds / 86400)} days ago`;\n  };\n\n  return (\n    <div data-testid=\"map-view\" ref={mapRef} style={{ height: '600px', width: '100%' }} />\n  );\n};\n\nexport default MapView;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}